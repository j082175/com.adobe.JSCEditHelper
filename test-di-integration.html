<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>DI Integration Test - Phase 1.3</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #2d2d2d; color: #fff; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #555; border-radius: 5px; }
        .success { background: #1e3a1e; border-color: #4caf50; }
        .error { background: #3a1e1e; border-color: #f44336; }
        .info { background: #1e2a3a; border-color: #2196f3; }
        pre { background: #1a1a1a; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ§ª DI Integration Test - Phase 1.3</h1>
    
    <div class="test-section info">
        <h3>ğŸ“‹ í…ŒìŠ¤íŠ¸ ê°œìš”</h3>
        <p>Phase 1.1-1.2ë¡œ êµ¬í˜„ëœ DI ì‹œìŠ¤í…œê³¼ utils.ts í†µí•©ì„ ê²€ì¦í•©ë‹ˆë‹¤.</p>
    </div>

    <div id="test-results"></div>
    
    <button onclick="runAllTests()">ğŸš€ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    <button onclick="clearResults()">ğŸ§¹ ê²°ê³¼ ì§€ìš°ê¸°</button>

    <!-- í•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ë“¤ ë¡œë“œ -->
    <script src="js/dependency-injection.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>

    <script>
        const results = document.getElementById('test-results');
        
        function addResult(title, success, message, details = '') {
            const div = document.createElement('div');
            div.className = `test-section ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <h3>${success ? 'âœ…' : 'âŒ'} ${title}</h3>
                <p><strong>ê²°ê³¼:</strong> ${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        async function runAllTests() {
            clearResults();
            
            // Test 1: DI ì»¨í…Œì´ë„ˆ ì¡´ì¬ í™•ì¸
            try {
                const diExists = typeof window.DI !== 'undefined';
                addResult(
                    'DI ì»¨í…Œì´ë„ˆ ì¡´ì¬ í™•ì¸',
                    diExists,
                    diExists ? 'DI ì»¨í…Œì´ë„ˆê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨' : 'DI ì»¨í…Œì´ë„ˆê°€ ì—†ìŒ',
                    diExists ? `DI íƒ€ì…: ${typeof window.DI}` : ''
                );
            } catch (e) {
                addResult('DI ì»¨í…Œì´ë„ˆ ì¡´ì¬ í™•ì¸', false, `ì˜¤ë¥˜: ${e.message}`);
            }
            
            // Test 2: Utils ëª¨ë“ˆ ë¡œë“œ í™•ì¸
            try {
                const utilsExists = typeof window.JSCUtils !== 'undefined';
                addResult(
                    'Utils ëª¨ë“ˆ ë¡œë“œ í™•ì¸',
                    utilsExists,
                    utilsExists ? 'JSCUtilsê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨' : 'JSCUtilsê°€ ì—†ìŒ',
                    utilsExists ? `Utils íƒ€ì…: ${typeof window.JSCUtils}` : ''
                );
            } catch (e) {
                addResult('Utils ëª¨ë“ˆ ë¡œë“œ í™•ì¸', false, `ì˜¤ë¥˜: ${e.message}`);
            }
            
            // Test 3: DI Status í™•ì¸ (Phase 1.2 ê¸°ëŠ¥)
            try {
                if (window.JSCUtils && typeof window.JSCUtils.getDIStatus === 'function') {
                    const diStatus = window.JSCUtils.getDIStatus();
                    addResult(
                        'DI Status í™•ì¸ (Phase 1.2)',
                        true,
                        `DI ìƒíƒœ: ${diStatus.containerInfo}`,
                        `Available: ${diStatus.isDIAvailable}\\nInfo: ${diStatus.containerInfo}`
                    );
                } else {
                    addResult('DI Status í™•ì¸ (Phase 1.2)', false, 'getDIStatus í•¨ìˆ˜ê°€ ì—†ìŒ');
                }
            } catch (e) {
                addResult('DI Status í™•ì¸ (Phase 1.2)', false, `ì˜¤ë¥˜: ${e.message}`);
            }
            
            // Test 4: ì„œë¹„ìŠ¤ ë“±ë¡ í™•ì¸
            try {
                if (window.DI && window.DI.validateDependencies) {
                    const requiredServices = ['JSCUtils', 'JSCUIManager', 'JSCStateManager', 'JSCCommunication', 'JSCEventManager'];
                    const validation = window.DI.validateDependencies(requiredServices);
                    addResult(
                        'ì„œë¹„ìŠ¤ ë“±ë¡ í™•ì¸',
                        validation.isValid,
                        validation.isValid ? 'ëª¨ë“  í•„ìˆ˜ ì„œë¹„ìŠ¤ê°€ ë“±ë¡ë¨' : `ëˆ„ë½ëœ ì„œë¹„ìŠ¤: ${validation.missing.join(', ')}`,
                        `ê²€ì¦ ê²°ê³¼: ${JSON.stringify(validation, null, 2)}`
                    );
                } else {
                    addResult('ì„œë¹„ìŠ¤ ë“±ë¡ í™•ì¸', false, 'DI.validateDependenciesê°€ ì—†ìŒ');
                }
            } catch (e) {
                addResult('ì„œë¹„ìŠ¤ ë“±ë¡ í™•ì¸', false, `ì˜¤ë¥˜: ${e.message}`);
            }
            
            // Test 5: Utils ë¡œê¹… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
            try {
                if (window.JSCUtils) {
                    // ì½˜ì†” ë¡œê·¸ ìº¡ì²˜ë¥¼ ìœ„í•œ ì„ì‹œ ì €ì¥
                    const originalLog = console.log;
                    let logMessage = '';
                    console.log = function(...args) {
                        logMessage = args.join(' ');
                        originalLog.apply(console, args);
                    };
                    
                    window.JSCUtils.logInfo('DI Integration Test Message');
                    
                    // ì½˜ì†” ë³µì›
                    console.log = originalLog;
                    
                    const hasMessage = logMessage.includes('DI Integration Test Message');
                    addResult(
                        'Utils ë¡œê¹… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸',
                        hasMessage,
                        hasMessage ? 'ë¡œê¹…ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•¨' : 'ë¡œê¹… ë©”ì‹œì§€ê°€ ê°ì§€ë˜ì§€ ì•ŠìŒ',
                        `ìº¡ì²˜ëœ ë©”ì‹œì§€: ${logMessage}`
                    );
                } else {
                    addResult('Utils ë¡œê¹… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸', false, 'JSCUtilsê°€ ì—†ìŒ');
                }
            } catch (e) {
                addResult('Utils ë¡œê¹… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸', false, `ì˜¤ë¥˜: ${e.message}`);
            }
            
            // Test 6: App ì´ˆê¸°í™” ìƒíƒœ í™•ì¸
            try {
                if (window.JSCApp) {
                    const isInitialized = window.JSCApp._initialized;
                    addResult(
                        'App ì´ˆê¸°í™” ìƒíƒœ í™•ì¸',
                        isInitialized,
                        isInitialized ? 'Appì´ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë¨' : 'App ì´ˆê¸°í™” ì‹¤íŒ¨ ë˜ëŠ” ë¯¸ì™„ë£Œ',
                        `ì´ˆê¸°í™” ìƒíƒœ: ${isInitialized}`
                    );
                } else {
                    addResult('App ì´ˆê¸°í™” ìƒíƒœ í™•ì¸', false, 'JSCAppì´ ì—†ìŒ');
                }
            } catch (e) {
                addResult('App ì´ˆê¸°í™” ìƒíƒœ í™•ì¸', false, `ì˜¤ë¥˜: ${e.message}`);
            }
            
            // ìš”ì•½ ì •ë³´
            const allDivs = results.querySelectorAll('.test-section');
            const successCount = results.querySelectorAll('.success').length;
            const totalCount = allDivs.length - 1; // ì²« ë²ˆì§¸ëŠ” ê°œìš”
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-section ${successCount === totalCount ? 'success' : 'error'}`;
            summaryDiv.innerHTML = `
                <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ìš”ì•½</h3>
                <p><strong>í†µê³¼:</strong> ${successCount}/${totalCount}</p>
                <p><strong>Phase 1.3 ìƒíƒœ:</strong> ${successCount === totalCount ? 'ì„±ê³µ âœ…' : 'ì¼ë¶€ ì‹¤íŒ¨ âš ï¸'}</p>
            `;
            results.appendChild(summaryDiv);
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', function() {
            console.log('ğŸ§ª DI Integration Test Page Loaded');
            setTimeout(runAllTests, 1000); // 1ì´ˆ í›„ ìë™ ì‹¤í–‰
        });
    </script>
</body>
</html>