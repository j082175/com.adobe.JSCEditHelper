<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>DI Integration Test - Phase 1.3</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #2d2d2d; color: #fff; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #555; border-radius: 5px; }
        .success { background: #1e3a1e; border-color: #4caf50; }
        .error { background: #3a1e1e; border-color: #f44336; }
        .info { background: #1e2a3a; border-color: #2196f3; }
        pre { background: #1a1a1a; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>🧪 DI Integration Test - Phase 1.3</h1>
    
    <div class="test-section info">
        <h3>📋 테스트 개요</h3>
        <p>Phase 1.1-1.2로 구현된 DI 시스템과 utils.ts 통합을 검증합니다.</p>
    </div>

    <div id="test-results"></div>
    
    <button onclick="runAllTests()">🚀 모든 테스트 실행</button>
    <button onclick="clearResults()">🧹 결과 지우기</button>

    <!-- 필요한 스크립트들 로드 -->
    <script src="js/dependency-injection.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>

    <script>
        const results = document.getElementById('test-results');
        
        function addResult(title, success, message, details = '') {
            const div = document.createElement('div');
            div.className = `test-section ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <h3>${success ? '✅' : '❌'} ${title}</h3>
                <p><strong>결과:</strong> ${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        async function runAllTests() {
            clearResults();
            
            // Test 1: DI 컨테이너 존재 확인
            try {
                const diExists = typeof window.DI !== 'undefined';
                addResult(
                    'DI 컨테이너 존재 확인',
                    diExists,
                    diExists ? 'DI 컨테이너가 성공적으로 로드됨' : 'DI 컨테이너가 없음',
                    diExists ? `DI 타입: ${typeof window.DI}` : ''
                );
            } catch (e) {
                addResult('DI 컨테이너 존재 확인', false, `오류: ${e.message}`);
            }
            
            // Test 2: Utils 모듈 로드 확인
            try {
                const utilsExists = typeof window.JSCUtils !== 'undefined';
                addResult(
                    'Utils 모듈 로드 확인',
                    utilsExists,
                    utilsExists ? 'JSCUtils가 성공적으로 로드됨' : 'JSCUtils가 없음',
                    utilsExists ? `Utils 타입: ${typeof window.JSCUtils}` : ''
                );
            } catch (e) {
                addResult('Utils 모듈 로드 확인', false, `오류: ${e.message}`);
            }
            
            // Test 3: DI Status 확인 (Phase 1.2 기능)
            try {
                if (window.JSCUtils && typeof window.JSCUtils.getDIStatus === 'function') {
                    const diStatus = window.JSCUtils.getDIStatus();
                    addResult(
                        'DI Status 확인 (Phase 1.2)',
                        true,
                        `DI 상태: ${diStatus.containerInfo}`,
                        `Available: ${diStatus.isDIAvailable}\\nInfo: ${diStatus.containerInfo}`
                    );
                } else {
                    addResult('DI Status 확인 (Phase 1.2)', false, 'getDIStatus 함수가 없음');
                }
            } catch (e) {
                addResult('DI Status 확인 (Phase 1.2)', false, `오류: ${e.message}`);
            }
            
            // Test 4: 서비스 등록 확인
            try {
                if (window.DI && window.DI.validateDependencies) {
                    const requiredServices = ['JSCUtils', 'JSCUIManager', 'JSCStateManager', 'JSCCommunication', 'JSCEventManager'];
                    const validation = window.DI.validateDependencies(requiredServices);
                    addResult(
                        '서비스 등록 확인',
                        validation.isValid,
                        validation.isValid ? '모든 필수 서비스가 등록됨' : `누락된 서비스: ${validation.missing.join(', ')}`,
                        `검증 결과: ${JSON.stringify(validation, null, 2)}`
                    );
                } else {
                    addResult('서비스 등록 확인', false, 'DI.validateDependencies가 없음');
                }
            } catch (e) {
                addResult('서비스 등록 확인', false, `오류: ${e.message}`);
            }
            
            // Test 5: Utils 로깅 기능 테스트
            try {
                if (window.JSCUtils) {
                    // 콘솔 로그 캡처를 위한 임시 저장
                    const originalLog = console.log;
                    let logMessage = '';
                    console.log = function(...args) {
                        logMessage = args.join(' ');
                        originalLog.apply(console, args);
                    };
                    
                    window.JSCUtils.logInfo('DI Integration Test Message');
                    
                    // 콘솔 복원
                    console.log = originalLog;
                    
                    const hasMessage = logMessage.includes('DI Integration Test Message');
                    addResult(
                        'Utils 로깅 기능 테스트',
                        hasMessage,
                        hasMessage ? '로깅이 정상적으로 작동함' : '로깅 메시지가 감지되지 않음',
                        `캡처된 메시지: ${logMessage}`
                    );
                } else {
                    addResult('Utils 로깅 기능 테스트', false, 'JSCUtils가 없음');
                }
            } catch (e) {
                addResult('Utils 로깅 기능 테스트', false, `오류: ${e.message}`);
            }
            
            // Test 6: App 초기화 상태 확인
            try {
                if (window.JSCApp) {
                    const isInitialized = window.JSCApp._initialized;
                    addResult(
                        'App 초기화 상태 확인',
                        isInitialized,
                        isInitialized ? 'App이 성공적으로 초기화됨' : 'App 초기화 실패 또는 미완료',
                        `초기화 상태: ${isInitialized}`
                    );
                } else {
                    addResult('App 초기화 상태 확인', false, 'JSCApp이 없음');
                }
            } catch (e) {
                addResult('App 초기화 상태 확인', false, `오류: ${e.message}`);
            }
            
            // 요약 정보
            const allDivs = results.querySelectorAll('.test-section');
            const successCount = results.querySelectorAll('.success').length;
            const totalCount = allDivs.length - 1; // 첫 번째는 개요
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-section ${successCount === totalCount ? 'success' : 'error'}`;
            summaryDiv.innerHTML = `
                <h3>📊 테스트 요약</h3>
                <p><strong>통과:</strong> ${successCount}/${totalCount}</p>
                <p><strong>Phase 1.3 상태:</strong> ${successCount === totalCount ? '성공 ✅' : '일부 실패 ⚠️'}</p>
            `;
            results.appendChild(summaryDiv);
        }
        
        // 페이지 로드시 자동 실행
        window.addEventListener('load', function() {
            console.log('🧪 DI Integration Test Page Loaded');
            setTimeout(runAllTests, 1000); // 1초 후 자동 실행
        });
    </script>
</body>
</html>