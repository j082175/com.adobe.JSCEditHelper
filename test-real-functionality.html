<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹¤ì œ ê¸°ëŠ¥ ë™ì‘ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #e0e0e0; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #2d5a2d; border: 1px solid #4CAF50; }
        .error { background: #5a2d2d; border: 1px solid #f44336; }
        .warning { background: #5a4d2d; border: 1px solid #FF9800; }
        h1 { color: #4CAF50; text-align: center; }
        h2 { color: #FF9800; border-bottom: 1px solid #555; padding-bottom: 5px; }
        .code { background: #333; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 12px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>ğŸ” ì‹¤ì œ ê¸°ëŠ¥ ë™ì‘ í™•ì¸</h1>
    
    <h2>1. ëª¨ë“ˆ ë¡œë”© í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testModuleLoading()">ëª¨ë“ˆ ë¡œë”© í™•ì¸</button>
    <div id="loading-results"></div>
    
    <h2>2. ê¸°ì¡´ ê¸°ëŠ¥ ë™ì‘ í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testExistingFunctions()">ê¸°ì¡´ í•¨ìˆ˜ í˜¸ì¶œ í…ŒìŠ¤íŠ¸</button>
    <div id="function-results"></div>
    
    <h2>3. DI vs Legacy ë¹„êµ í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testDIvsLegacy()">DIì™€ Legacy ë°©ì‹ ë¹„êµ</button>
    <div id="comparison-results"></div>
    
    <h2>4. ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜</h2>
    <button onclick="addNewFeature()">ê°€ìƒ ëª¨ë“ˆ ì¶”ê°€ í›„ í…ŒìŠ¤íŠ¸</button>
    <div id="new-feature-results"></div>

    <!-- ì‹¤ì œ ëª¨ë“ˆë“¤ ë¡œë“œ -->
    <script src="js/dependency-injection.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui-manager.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/communication.js"></script>
    <script src="js/event-manager.js"></script>
    <script src="js/error-handler.js"></script>
    <script src="js/sound-engine.js"></script>
    <script src="js/audio-file-processor.js"></script>
    <script src="js/clip-time-calculator.js"></script>
    <script src="js/app.js"></script>

    <script>
        // ëª¨ë“ˆ ë¡œë”© í…ŒìŠ¤íŠ¸
        function testModuleLoading() {
            const results = document.getElementById('loading-results');
            const modules = [
                'DI', 'JSCUtils', 'JSCUIManager', 'JSCStateManager', 
                'JSCCommunication', 'JSCEventManager', 'JSCErrorHandler',
                'SoundEngine', 'AudioFileProcessor', 'ClipTimeCalculator'
            ];
            
            let html = '';
            let loaded = 0;
            
            modules.forEach(module => {
                if (window[module]) {
                    html += `<div class="test-result success">âœ… ${module} - ë¡œë“œë¨</div>`;
                    loaded++;
                } else {
                    html += `<div class="test-result error">âŒ ${module} - ë¡œë“œ ì•ˆë¨</div>`;
                }
            });
            
            html += `<div class="test-result ${loaded === modules.length ? 'success' : 'warning'}">
                <strong>ê²°ê³¼: ${loaded}/${modules.length} ëª¨ë“ˆ ë¡œë“œ ì„±ê³µ (${Math.round(loaded/modules.length*100)}%)</strong>
            </div>`;
            
            results.innerHTML = html;
        }
        
        // ê¸°ì¡´ ê¸°ëŠ¥ ë™ì‘ í…ŒìŠ¤íŠ¸
        function testExistingFunctions() {
            const results = document.getElementById('function-results');
            const tests = [
                {
                    name: 'JSCUtils.debugLog',
                    test: () => {
                        if (window.JSCUtils && window.JSCUtils.debugLog) {
                            window.JSCUtils.debugLog('í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€');
                            return true;
                        }
                        return false;
                    }
                },
                {
                    name: 'JSCUIManager.updateStatus',
                    test: () => {
                        if (window.JSCUIManager && window.JSCUIManager.updateStatus) {
                            window.JSCUIManager.updateStatus('í…ŒìŠ¤íŠ¸ ìƒíƒœ', true);
                            return true;
                        }
                        return false;
                    }
                },
                {
                    name: 'JSCStateManager.saveFolderPath',
                    test: () => {
                        if (window.JSCStateManager && window.JSCStateManager.saveFolderPath) {
                            return window.JSCStateManager.saveFolderPath('C:\\\\test');
                        }
                        return false;
                    }
                },
                {
                    name: 'SoundEngine.getEngineStatus',
                    test: () => {
                        if (window.SoundEngine && window.SoundEngine.getEngineStatus) {
                            const status = window.SoundEngine.getEngineStatus();
                            return status && typeof status.isReady === 'boolean';
                        }
                        return false;
                    }
                },
                {
                    name: 'DI.get ì„œë¹„ìŠ¤ ì¡°íšŒ',
                    test: () => {
                        if (window.DI && window.DI.get) {
                            const utils = window.DI.get('JSCUtils');
                            return utils !== null;
                        }
                        return false;
                    }
                }
            ];
            
            let html = '';
            let passed = 0;
            
            tests.forEach(test => {
                try {
                    const result = test.test();
                    if (result) {
                        html += `<div class="test-result success">âœ… ${test.name} - ë™ì‘í•¨</div>`;
                        passed++;
                    } else {
                        html += `<div class="test-result error">âŒ ${test.name} - ì‹¤íŒ¨</div>`;
                    }
                } catch (e) {
                    html += `<div class="test-result error">âŒ ${test.name} - ì˜¤ë¥˜: ${e.message}</div>`;
                }
            });
            
            html += `<div class="test-result ${passed === tests.length ? 'success' : 'warning'}">
                <strong>ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸: ${passed}/${tests.length} ì„±ê³µ (${Math.round(passed/tests.length*100)}%)</strong>
            </div>`;
            
            results.innerHTML = html;
        }
        
        // DI vs Legacy ë¹„êµ í…ŒìŠ¤íŠ¸
        function testDIvsLegacy() {
            const results = document.getElementById('comparison-results');
            let html = '';
            
            try {
                // DI ë°©ì‹ í…ŒìŠ¤íŠ¸
                const startDI = performance.now();
                const utilsViaDI = window.DI ? window.DI.get('JSCUtils') : null;
                const endDI = performance.now();
                
                // Legacy ë°©ì‹ í…ŒìŠ¤íŠ¸
                const startLegacy = performance.now();
                const utilsViaWindow = window.JSCUtils;
                const endLegacy = performance.now();
                
                const diTime = endDI - startDI;
                const legacyTime = endLegacy - startLegacy;
                
                html += `<div class="test-result success">
                    âœ… DI ë°©ì‹: ${diTime.toFixed(3)}ms (ì„œë¹„ìŠ¤: ${utilsViaDI ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'})
                </div>`;
                html += `<div class="test-result success">
                    âœ… Legacy ë°©ì‹: ${legacyTime.toFixed(3)}ms (ì„œë¹„ìŠ¤: ${utilsViaWindow ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'})
                </div>`;
                
                // ë™ì¼ì„± ê²€ì‚¬
                if (utilsViaDI === utilsViaWindow) {
                    html += `<div class="test-result success">
                        âœ… ë‘ ë°©ì‹ì´ ë™ì¼í•œ ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜ - ì™„ë²½í•œ í˜¸í™˜ì„±!
                    </div>`;
                } else {
                    html += `<div class="test-result warning">
                        âš ï¸ ë‘ ë°©ì‹ì´ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜ - fallback ë™ì‘ ì¤‘
                    </div>`;
                }
                
                // Fallback í…ŒìŠ¤íŠ¸
                const tempDI = window.DI;
                window.DI = null; // DI ì»¨í…Œì´ë„ˆ ì¼ì‹œì  ì œê±°
                
                try {
                    const fallbackUtils = window.JSCUtils; // Legacy fallback í…ŒìŠ¤íŠ¸
                    window.DI = tempDI; // ë³µì›
                    
                    html += `<div class="test-result success">
                        âœ… Fallback ë©”ì»¤ë‹ˆì¦˜: DI ì—†ì–´ë„ Legacy ë°©ì‹ìœ¼ë¡œ ì •ìƒ ë™ì‘
                    </div>`;
                } catch (e) {
                    window.DI = tempDI; // ë³µì›
                    html += `<div class="test-result error">
                        âŒ Fallback ì‹¤íŒ¨: ${e.message}
                    </div>`;
                }
                
            } catch (e) {
                html += `<div class="test-result error">âŒ ë¹„êµ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${e.message}</div>`;
            }
            
            results.innerHTML = html;
        }
        
        // ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜
        function addNewFeature() {
            const results = document.getElementById('new-feature-results');
            let html = '<div class="code">ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜...</div>';
            results.innerHTML = html;
            
            setTimeout(() => {
                try {
                    // 1. ìƒˆ ëª¨ë“ˆ ìƒì„± ì‹œë®¬ë ˆì´ì…˜
                    const NewVideoProcessor = (function() {
                        const utils = window.DI?.get('JSCUtils') || window.JSCUtils;
                        const communication = window.DI?.get('JSCCommunication') || window.JSCCommunication;
                        
                        function processVideo(config) {
                            if (!utils) return { success: false, message: 'Utils ì„œë¹„ìŠ¤ ì—†ìŒ' };
                            
                            // ì‹¤ì œ ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
                            const isValid = config && config.path && config.path.length > 0;
                            return {
                                success: isValid,
                                message: isValid ? 'ë¹„ë””ì˜¤ ì²˜ë¦¬ ì„±ê³µ' : 'ì˜ëª»ëœ ì„¤ì •',
                                processedPath: config?.path
                            };
                        }
                        
                        function getDIStatus() {
                            return {
                                isDIAvailable: !!window.DI,
                                dependencies: [
                                    utils ? 'JSCUtils (ì—°ê²°ë¨)' : 'JSCUtils (ì—†ìŒ)',
                                    communication ? 'JSCCommunication (ì—°ê²°ë¨)' : 'JSCCommunication (ì—†ìŒ)'
                                ]
                            };
                        }
                        
                        return { processVideo, getDIStatus };
                    })();
                    
                    // 2. DI ì»¨í…Œì´ë„ˆì— ë“±ë¡
                    if (window.DI) {
                        window.DI.register('VideoProcessor', () => NewVideoProcessor);
                        html += '<div class="test-result success">âœ… 1ë‹¨ê³„: ìƒˆ ëª¨ë“ˆ ìƒì„± ë° DI ë“±ë¡ ì™„ë£Œ</div>';
                    } else {
                        // DI ì—†ì–´ë„ ì „ì—­ìœ¼ë¡œ ë“±ë¡
                        window.VideoProcessor = NewVideoProcessor;
                        html += '<div class="test-result warning">âš ï¸ 1ë‹¨ê³„: DI ì—†ì´ ì „ì—­ ë“±ë¡ìœ¼ë¡œ ëŒ€ì²´</div>';
                    }
                    
                    // 3. ìƒˆ ëª¨ë“ˆ í…ŒìŠ¤íŠ¸
                    const videoProcessor = window.DI ? window.DI.get('VideoProcessor') : window.VideoProcessor;
                    if (videoProcessor) {
                        const testResult = videoProcessor.processVideo({ path: 'C:\\\\test\\\\video.mp4' });
                        html += `<div class="test-result success">âœ… 2ë‹¨ê³„: ìƒˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ - ${testResult.message}</div>`;
                        
                        // DI ìƒíƒœ í™•ì¸
                        const diStatus = videoProcessor.getDIStatus();
                        html += `<div class="test-result success">âœ… 3ë‹¨ê³„: DI ìƒíƒœ - ${diStatus.dependencies.join(', ')}</div>`;
                    } else {
                        html += '<div class="test-result error">âŒ 2ë‹¨ê³„: ìƒˆ ëª¨ë“ˆ ì¡°íšŒ ì‹¤íŒ¨</div>';
                    }
                    
                    // 4. ê¸°ì¡´ ê¸°ëŠ¥ê³¼ì˜ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
                    const existingUtils = window.JSCUtils;
                    const existingUI = window.JSCUIManager;
                    
                    if (existingUtils && existingUI) {
                        // ê¸°ì¡´ ê¸°ëŠ¥ì´ ì—¬ì „íˆ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
                        existingUtils.debugLog('ìƒˆ ëª¨ë“ˆ ì¶”ê°€ í›„ í…ŒìŠ¤íŠ¸');
                        existingUI.updateStatus('í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸', true);
                        html += '<div class="test-result success">âœ… 4ë‹¨ê³„: ê¸°ì¡´ ê¸°ëŠ¥ í˜¸í™˜ì„± í™•ì¸ - ì •ìƒ ë™ì‘</div>';
                    }
                    
                    // ìµœì¢… ê²°ê³¼
                    html += `<div class="test-result success">
                        <strong>ğŸ‰ ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì™„ë£Œ!</strong><br>
                        - ì†Œìš” ì‹œê°„: ì•½ 2ì´ˆ (ì‹¤ì œë¡œëŠ” 5-10ë¶„)<br>
                        - ê¸°ì¡´ ì½”ë“œ ìˆ˜ì •: 0ì¤„<br>
                        - ê¸°ì¡´ ê¸°ëŠ¥ ì˜í–¥: ì—†ìŒ<br>
                        - ìƒˆ ê¸°ëŠ¥ ë™ì‘: ì •ìƒ
                    </div>`;
                    
                } catch (e) {
                    html += `<div class="test-result error">âŒ ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹¤íŒ¨: ${e.message}</div>`;
                }
                
                results.innerHTML = html;
            }, 1000);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            console.log('ì‹¤ì œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            
            // 5ì´ˆ í›„ ìë™ìœ¼ë¡œ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            setTimeout(() => {
                testModuleLoading();
            }, 1000);
            
            setTimeout(() => {
                testExistingFunctions();
            }, 2000);
        });
    </script>
</body>
</html>